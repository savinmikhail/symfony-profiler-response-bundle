{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        {{ include('@ResponseProfiler/Icon/response-body.svg') }}
        <span class="sf-toolbar-value">{{ collector.json ? 'JSON' : (collector.mime ?: 'n/a') }}</span>
        {% if collector.captured %}
            <span class="sf-toolbar-label">{{ (collector.size / 1024)|number_format(1) }} KB</span>
        {% endif %}
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Content-Type</b>
            <span>{{ collector.contentType ?: 'unknown' }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Size</b>
            <span>{{ collector.size }} B{% if collector.truncated %} (truncated){% endif %}</span>
        </div>
    {% endset %}

    {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { link: collector.captured ? profiler_url : false }) }}
{% endblock %}

{% block menu %}
    <span class="label {{ collector.captured ? '' : 'disabled' }}">
        <span class="icon">{{ include('@ResponseProfiler/Icon/response-body.svg') }}</span>
        <strong>Response Body</strong>
    </span>
{% endblock %}

{% block panel %}
    <style>
        .rfp-body-actions { display:flex; gap:.5rem; align-items:center; margin: .5rem 0 1rem; }
        .rfp-badge { background: var(--highlight-color, #2ea44f); color:#fff; border-radius: 3px; padding: 2px 6px; font-size: 12px; }
        .rfp-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .rfp-pre { white-space: pre-wrap; word-break: break-word; }
    </style>

    <h2>Response Body</h2>

    {% if not collector.captured %}
        <div class="empty">
            <p>No capturable response body ({{ collector.reason ?: 'unknown reason' }}).</p>
            {% if collector.contentType %}
                <p>Content-Type: <code>{{ collector.contentType }}</code></p>
            {% endif %}
        </div>
    {% else %}
        <div class="metrics">
            <div class="metric">
                <span class="value">{{ collector.mime ?: 'n/a' }}</span>
                <span class="label">MIME</span>
            </div>
            <div class="metric">
                <span class="value">{{ collector.size }} <span class="unit">B</span></span>
                <span class="label">Original size</span>
            </div>
            <div class="metric">
                <span class="value">{{ collector.displaySize }} <span class="unit">B</span></span>
                <span class="label">Displayed</span>
            </div>
            <div class="metric">
                <span class="value">{{ collector.maxLength }} <span class="unit">B</span></span>
                <span class="label">Max length</span>
            </div>
        </div>

        <div class="rfp-body-actions">
            {% if collector.json %}<span class="rfp-badge">JSON</span>{% endif %}
            <a class="btn btn-sm" href="data:text/plain;charset=utf-8,{{ collector.content|url_encode }}" download="response{{ collector.json ? '.json' : '.txt' }}">Download</a>
            <button class="btn btn-sm" type="button" onclick="navigator.clipboard.writeText(document.getElementById('rfp-body').innerText)">Copy</button>
            {% if collector.truncated %}
                <span class="label">Truncated at {{ collector.maxLength }} bytes</span>
            {% endif %}
        </div>

        <h3>Body</h3>
        <pre id="rfp-body" class="sf-dump sf-reset rfp-mono rfp-pre">{{ collector.content }}</pre>
    {% endif %}
{% endblock %}
